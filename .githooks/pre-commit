#!/bin/sh

# Get staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

if [[ "$STAGED_FILES" = "" ]]; then
    echo "No staged files to lint"
    exit 0
fi

echo "Running lint:fix script on: $STAGED_FILES"

if ! command -v pnpm &> /dev/null; then
    echo "pnpm not found. Please install pnpm"
    exit 1
fi

# Stash unstaged changes
git stash -q --keep-index

if ! pnpm run lint:fix -- $STAGED_FILES; then
    echo "Linting failed. Please fix the errors and try committing again."
    git stash pop -q
    exit 1
fi

# Add fixed files back to staging
git add $STAGED_FILES

# Restore unstaged changes
git stash pop -q

echo "Linting completed successfully"
exit 0